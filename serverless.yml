service: control-confeccion
frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs18.x
  region: us-east-1
  stage: ${env:STAGE, 'dev'}
  memorySize: 256
  timeout: 15
  httpApi:
    cors:
      allowedOrigins:
        - '*'
      allowedHeaders:
        - Content-Type
        - Authorization
        - X-Amz-Date
        - X-Api-Key
        - X-Amz-Security-Token
      allowedMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
        
  environment:
    ORACLE_HOST: ${env:ORACLE_HOST}
    ORACLE_PORT: ${env:ORACLE_PORT, '1521'}
    ORACLE_SERVICE: ${env:ORACLE_SERVICE}
    ORACLE_USER: ${env:ORACLE_USER}
    ORACLE_PASSWORD: ${env:ORACLE_PASSWORD}
    # Opcional: tamaño de pool
    ORACLE_POOL_MIN: '1'
    ORACLE_POOL_MAX: '4'

functions:
  # =========================
  # Productos
  # =========================
  productos-list:
    handler: src/handlers/productos.listar
    events:
      - httpApi:
          path: /productos
          method: GET

  productos-create:
    handler: src/handlers/productos.crear
    events:
      - httpApi:
          path: /productos
          method: POST

  productos-update:
    handler: src/handlers/productos.actualizar
    events:
      - httpApi:
          path: /productos/{id}
          method: PUT

  productos-delete:
    handler: src/handlers/productos.eliminar
    events:
      - httpApi:
          path: /productos/{id}
          method: DELETE

  # =========================
  # Inventario
  # =========================
  inventario-list:
    handler: src/handlers/inventario.listar
    events:
      - httpApi:
          path: /inventario
          method: GET

  inventario-mov:
    handler: src/handlers/inventario.movimiento
    events:
      - httpApi:
          path: /mov
          method: POST

  # =========================
  # Órdenes
  # =========================
  ordenes-list:
    handler: src/handlers/ordenes.listar
    events:
      - httpApi:
          path: /ordenes
          method: GET

  ordenes-create:
    handler: src/handlers/ordenes.crear
    events:
      - httpApi:
          path: /ordenes
          method: POST

  ordenes-update:
    handler: src/handlers/ordenes.actualizar
    events:
      - httpApi:
          path: /ordenes/{id}
          method: PUT

plugins:
  - serverless-offline
